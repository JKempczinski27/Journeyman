[databases]
; Database name = connection string
journeymandb = host=postgres port=5432 dbname=journeymandb user=journeymanuser password=journeymanpass

[pgbouncer]
; Connection pooling mode
; session - client connects to one server, connection returned to pool after disconnect
; transaction - connection returned after transaction (recommended for high traffic)
; statement - most aggressive, return connection after each statement (use with caution)
pool_mode = transaction

; Listen address and port
listen_addr = 0.0.0.0
listen_port = 6432

; Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Administrator
admin_users = admin

; Connection limits
; Maximum number of client connections
max_client_conn = 10000

; Default pool size for a database (max connections per user+database pair)
default_pool_size = 25

; Minimum pool size (always keep this many connections open)
min_pool_size = 5

; Reserve pool (additional connections if default pool is full)
reserve_pool_size = 5

; Maximum time a connection can stay idle before being closed (seconds)
reserve_pool_timeout = 3

; Maximum number of server connections (to PostgreSQL)
; Should not exceed PostgreSQL max_connections
max_db_connections = 100

; Maximum number of server connections per database
max_user_connections = 50

; Connection timeouts
; How long to wait for server connection (seconds)
server_connect_timeout = 15

; Server login retry (seconds)
server_login_retry = 15

; How long to wait for query response (seconds)
query_wait_timeout = 120

; Client idle timeout (seconds)
client_idle_timeout = 0

; Server idle timeout (seconds)
server_idle_timeout = 600

; Server lifetime (max time connection can be used, seconds)
server_lifetime = 3600

; Server check query
server_check_query = SELECT 1

; Server check delay (seconds)
server_check_delay = 30

; Server reset query (sent when releasing connection back to pool)
server_reset_query = DISCARD ALL

; DNS settings
; How often to check DNS for changes (seconds)
dns_max_ttl = 15
dns_zone_check_period = 0

; Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1

; Verbose logging (0=off, 1=on)
verbose = 0

; Statistics
stats_period = 60

; Performance tuning
; SO_REUSEPORT allows multiple processes to bind to same port
so_reuseport = 1

; TCP keepalive settings
tcp_keepalive = 1
tcp_keepidle = 60
tcp_keepintvl = 10
tcp_keepcnt = 5

; Buffer sizes (bytes)
pkt_buf = 4096
sbuf_loopcnt = 5

; Prepared statements
; In transaction pooling mode, prepared statements must be disabled
max_prepared_statements = 0

; Application name
application_name_add_host = 1

[users]
; User-specific pool sizes can be set here
; journeymanuser = pool_size=30

; For high-traffic scenarios, you can set different pool sizes per user
; premium_user = pool_size=50
; regular_user = pool_size=20
